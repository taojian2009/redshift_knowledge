### Redshift架构概述

![Tux, the Linux mascot](./image/redshift_架构.png)

1. 客户端应用程序 postgreSQL的JDBC

2. 集群节点--master
3. 计算节点--worker

节点切片。 PostgreSQL 8.0.2

### 性能概述

大规模分布式并行计算

列式数据存储

数据压缩

结果缓存

SVL_QLOG 查看查询的history

### 列式存储概念

列存储->更适合查询 单列更适合分布式存储 同一列放在一起，数据类型相同，更好压缩 基于排序更方便，更快 行存储->更适合做事务

### 内部组件和功能概览

查询执行流程

### redshift日常操作

1. 创建数据库

```redshift
CREATE DATABASE test WITH
    OWNER guest
```

2. show databases

```redshift
SELECT datname
FROM pg_database
LIMIT 10;
```

3. 创建用户 md5hash

```redshift
CREATE USER guest PASSWORD data1234;
CREATE USER guest PASSWORD 'md5e43234sf34rfd' CREATEDB CONNECTION LIMIT 10;
```

4. 创建表信息

```redshift
CREATE
[ [LOCAL ] { TEMPORARY | TEMP } ]
TABLE
[ IF NOT EXISTS ] table_name
( { column_name data_type [column_attributes] [ column_constraints ] 
  | table_constraints
  | LIKE parent_table [ { INCLUDING | EXCLUDING } DEFAULTS ] } 
  [, ... ]  )
[ BACKUP { YES | NO } ]
[table_attribute]

WHERE column_attributes are:
  [ DEFAULT default_expr ]
  [ IDENTITY ( seed, step ) ] 
  [ GENERATED BY DEFAULT AS IDENTITY ( seed, step ) ]             
  [ ENCODE ENCODING ] 
  [ DISTKEY ] 
--  分区键
  [ SORTKEY ]
--  排序键
  [ COLLATE CASE_SENSITIVE | COLLATE CASE_INSENSITIVE  ]

AND column_constraints are:
  [ { NOT NULL | NULL } ]
-- 非空 | 空 
  [ { UNIQUE  |  PRIMARY KEY } ]
-- 唯一  主键
  [ REFERENCES reftable [ ( refcolumn ) ] ] 

AND table_constraints  are:
  [ UNIQUE ( column_name [, ... ] ) ]
  [ PRIMARY KEY ( column_name [, ... ] )  ]
  [ FOREIGN KEY (column_name [, ... ] ) REFERENCES reftable [ ( refcolumn ) ] 


AND table_attributes are:
  [ DISTSTYLE { AUTO | EVEN | KEY | ALL } ] 
-- ？
  [ DISTKEY ( column_name ) ]
-- ？ 
  [ [COMPOUND | INTERLEAVED ] SORTKEY ( column_name [,...]) |  [ SORTKEY AUTO ] ]
  [ ENCODE AUTO ]

```

创建表示例:

```redshift
CREATE TABLE IF NOT EXISTS staff
(
    id           integer IDENTITY (0, 1) DISTKEY NOT NULL PRIMARY KEY,
    -- 从0开始，每次递增1, 作为分区键
    name         varchar(max) ENCODE LZO,
    -- 表示以LZO格式压缩

    salary       decimal,
    entry_date   date SORTKEY,
    -- 排序键
    is_developer boolean
)
    BACKUP YES;
-- 是否本分快照。默认是yes 


```

5. 查询某个schema下有哪些表

```redshift
SELECT DISTINCT(tablename)
FROM pg_table_def
WHERE schemaname = "public";
```
